<!DOCTYPE html>
<html>
  <head>
    <title>Newsletter Signup</title>
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 30px;
      }

      form {
        margin-top: 20px;
      }

      input,
      button {
        padding: 10px;
        font-size: 18px;
      }

      button {
        margin-top: 10px;
      }
    </style>
  </head>

  <body>
    <h1>Sign up for our newsletter</h1>
    <form id="signup-form">
      <input type="email" id="email" placeholder="Your email address" />
      <button type="submit">Sign up</button>
    </form>
    <p id="message"></p>

    <button id="fetch-users">Show Registered Users</button>
  </body>
</html>

<script>
  document
    .getElementById('signup-form')
    .addEventListener('submit', async function (event) {
      event.preventDefault();

      const email = document.getElementById('email').value;
      const messageElement = document.getElementById('message');

      try {
        const response = await fetch(
          'http://localhost:4000/newsletter/signup',
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email: email }),
          }
        );

        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        const data = await response.json();

        if (data.error) {
          messageElement.textContent = 'Error: ' + data.error;
        } else {
          messageElement.textContent = 'Signed up with email: ' + data.email;
        }
      } catch (error) {
        console.error(
          'There has been a problem with your fetch operation: ',
          error
        );
        // Add these lines to print more error details
        console.log('Error message:', error.message);
        console.log('Error name:', error.name);
        console.log('Error stack:', error.stack);
      }
    });

  async function fetchUsers() {
    try {
      const response = await fetch(
        'http://localhost:4000/newsletter/registered'
      );
      const data = await response.json();
      console.log(data);
      // Vous pouvez afficher les données reçues ici.
      // Par exemple, vous pourriez les insérer dans un élément HTML.
    } catch (error) {
      console.error('Error:', error);
    }
  }

  document.getElementById('fetch-users').addEventListener('click', fetchUsers);
</script>
